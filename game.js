function t(){const k=document.getElementById("myCanvas");class x{constructor(t,e){this.x=t;this.y=e}t(t){return new x(this.x+t.x,this.y+t.y)}l(t){return new x(this.x-t.x,this.y-t.y)}i(t){return new x(this.x/t,this.y/t)}u(t){return new x(this.x*t,this.y*t)}o(){return Math.sqrt(this.x*this.x+this.y*this.y)}h(t,e){this.x+=(t.x-this.x)*e;this.y+=(t.y-this.y)*e}M(){let t=this.o();if(t<1e-8)return new x(0,0);return new x(this.x/t,this.y/t)}m(t){let e=Math.atan2(this.y,this.x);e+=t;return new x(Math.cos(e),Math.sin(e))}}let A=new x(0,0);let F=[];function t(){window.requestAnimationFrame(t);l()}let Z=Date.now();let L;let D;let G;let O;let y;let C;let j;let q=50;let u=[];let z=0;let B=0;let E=0;let H=0;let _=0;let tt=0;let et=0;let lt=0;let I=true;let J=0;let K=0;let N=1;let P=0;let Q=0;function R(l,n,f){for(let t=0;t<F.length;++t){if(t===n)continue;let e=F[t];if(e.v>0)continue;if(t>0)if(l.l(e.p.t(e.dir.u(.5))).o()<f)return true;if(l.l(e.p).o()<f)return true;for(let t=0;t<e.body.length;++t)if(l.l(e.body[t]).o()<f)return true}let t=1;return l.x>q-t||l.x<t||l.y>q-t||l.y<t}function o(t){if(t===0)return new x(q/2,q/2);let f=0;let i=0;let r=F[0].p.x;let u=F[0].p.y;for(let t=0;t<1e3;++t){let t=3;f=Math.random()*(q-t*2)+t;i=Math.random()*(q-t*2)+t;let e=true;let l=f-r;let n=i-u;if(l*l+n*n<100)e=false;for(let t=0;t<F.length;++t){l=f-F[t].p.x;n=i-F[t].p.y;if(l*l+n*n<25){e=false}}if(e)break}return new x(f,i)}function nt(t,e,f,i){let r=null;for(let n=t;n<=e;++n){for(let l=f;l<=i;++l){let t=l*q+n;let e=u[t];while(e!=null){e.g=r;r=e;e=e.next}}}return r}function ft(t){let e=U(Math.floor(t.x),1,q-2);let f=U(Math.floor(t.y),1,q-2);let i=null;for(let n=e-1;n<=e+1;++n){for(let l=f-1;l<=f+1;++l){let t=l*q+n;let e=u[t];while(e!=null){e.g=i;i=e;e=e.next}}}return i}function l(){let t=Date.now();let o=t-Z;Z=t;o=Math.min(o/1e3,.035);k.width=$(window).width()*2;k.height=$(window).height()*2;L=k.width;D=k.height;G=Math.min(L,D);O=15;y=G/O;C=new x(L*.5,D*.5);let e=A.l(C).i(y);let u=[];for(let t=0;t<q*q;++t)u[t]=null;function l(t,e,l){let n=U(Math.floor(t.x),0,q-1);let f=U(Math.floor(t.y),0,q-1);let i=f*q+n;let r={};r.k=l;r.p=t;r.id=e;r.next=u[i];u[i]=r}function f(t,f){let e=U(Math.floor(t.x),2,q-3);let i=U(Math.floor(t.y),2,q-3);let r=null;for(let n=e-2;n<=e+2;++n){for(let l=i-2;l<=i+2;++l){let t=l*q+n;let e=u[t];while(e!=null){if(e.id!==f){e.g=r;r=e}e=e.next}}}return r}function n(t,e,l){let n=f(t,e);while(n!=null){if(n.k){if(e>n.id)if(n.p.l(t).o()<l)return true}else{if(n.p.l(t).o()<l)return true}n=n.g}return false}function i(){let f=0;let i=0;for(let t=0;t<F.length;++t){let t=3;f=Math.random()*(q-t*2)+t;i=Math.random()*(q-t*2)+t;let l=U(Math.floor(f),5,q-6);let n=U(Math.floor(i),5,q-6);for(let e=l-5;e<=l+5;++e)for(let t=n-5;t<=n+5;++t)if(u[t*q+e]!=null)return new x(f,i)}return new x(f,i)}if(I){for(let t=0;t<F.length;++t){let e=F[t];if(e.v>0)continue;l(e.p,e.id,true);for(let t=0;t<e.body.length;++t)l(e.body[t],e.id,false)}for(let e=0;e<F.length;++e){let t=F[e];if(t.v>0)continue;if(n(t.p,e,1)){rt(t)}}for(let e=1;e<F.length;++e){let t=F[e];if(t.v>0){t.v-=o;if(t.v<=0){if(e>0)t.p=i()}}}if(e.o()>.01)F[0].dir=e.M();for(let e=1;e<F.length;++e){let t=F[e];if((t.A-=o)<0){t.A=Math.random()*.5+.5;t.F=-t.F;t.L=Math.random()>.3?Math.random()*10:0}t.D+=(t.L*t.F-t.D)*o*2;t.dir=t.dir.m(t.D*o)}for(let l=1;l<F.length;++l){let e=F[l];if(e.v>0)continue;if(R(e.p.t(e.dir.u(1)),l,e.G)){for(let t=1;t<100;++t){if(!R(e.p.t(e.dir.m(-.02*t).u(1)),l,e.G)){e.dir=e.dir.m(-.02*t);e.F=-e.F;break}if(!R(e.p.t(e.dir.m(.02*t).u(1)),l,e.G)){e.dir=e.dir.m(.02*t);e.F=-e.F;break}}}}for(let n=0;n<F.length;++n){let t=F[n];if(t.v>0)continue;t.p=t.p.t(t.dir.u(5*o));let e=t.p.x;let l=t.p.y;if(e<0||e>q||l<0||l>q)rt(t)}for(let t=0;t<F.length;++t){let n=F[t];if(n.v>0)continue;let f=ft(n.p);while(f!=null){let t=n.p.t(n.dir.u(.5));let e=t.l(f.p);let l=e.o();if(l<1){l=Math.max(0,l-o*10);f.p=t.l(e.M().u(l));if(t.l(f.p).o()<.1){n.O++;f.p=new x(Math.random()*q,Math.random()*q);f.$=it(f.p)?1:0;f.id=X++}V(f);W(f)}f=f.g}}}for(let t=0;t<F.length;++t){let n=F[t];if(n.v>0)continue;if(I){let t=5+n.O/50;if(n.C<t)n.C=Math.min(n.C+o*2,t);if(n.C>t)n.C=Math.max(n.C-o*4,t)}n.j.push(n.p);n.body=[];let f=0;let i=n.p;let r=.5;let u=n.C;for(f=n.j.length-2;f>=0;--f){let t=n.j[f];let e=t.l(i);let l=Math.min(Math.min(r,e.o()),u);u-=l;i=i.t(e.M().u(l));r-=l;if(u<1e-4){n.body.push(i);break}if(r<=0){++f;r=.5;n.body.push(i)}}while(--f>0)n.j.shift();if(u>1e-4)n.body.push(i)}Q=F[0].O;let r=L/G;let h=D/G;j=F[0].p;z=j.x-O*.5*r-1;B=j.x+O*.5*r+1;E=j.y-O*.5*h-1;H=j.y+O*.5*h+1;_=U(Math.floor(z),0,q-1);tt=U(Math.ceil(B),0,q-1);et=U(Math.floor(E),0,q-1);lt=U(Math.ceil(H),0,q-1);let a=k.getContext("2d");a.fillStyle="#222";a.fillRect(0,0,L,D);a.fillStyle="#333";for(let t=-1;t<=q+1;++t)S(a,t,q/2,.05,q/2+1);for(let t=-1;t<=q+1;++t)S(a,q/2,t,q/2+1,.05);let c=[];let M=nt(_,tt,et,lt);let s=M;while(s!=null){s.p.x=U(s.p.x,0,q);s.p.y=U(s.p.y,0,q);if(s.$<1)s.$=Math.min(s.$+o*2,1);s.q=(s.q+o*5)%(Math.PI*2);s.p.x+=Math.cos(s.q)*o*.3;s.p.y+=Math.sin(s.q)*o*.3;V(s);W(s);let t=0;while(t<c.length&&c[t].id<s.id)t++;c.splice(t,0,s);s=s.g}for(let l=0;l<c.length;++l){let t=c[l];let e=t.p.l(j).u(y);T(a,C.x+e.x,C.y+e.y,(t.size+.3)*t.$*y/2,"#000")}for(let l=0;l<c.length;++l){let t=c[l];let e=t.p.l(j).u(y);T(a,C.x+e.x,C.y+e.y,t.size*t.$*y/2,t.color)}for(let e=0;e<F.length;++e){let l=F[e];if(l.v>0)continue;for(let e=l.body.length-1;e>=0;--e){let t=l.body[e].l(j).u(y);T(a,C.x+t.x,C.y+t.y,(l.size+.2)*y/2,"#000")}let t=l.p.l(j).u(y);T(a,C.x+t.x,C.y+t.y,(l.size+.2)*y/2,"#000")}for(let e=0;e<F.length;++e){let l=F[e];if(l.v>0)continue;for(let e=l.body.length-1;e>=0;--e){let t=l.body[e].l(j).u(y);T(a,C.x+t.x,C.y+t.y,l.size*y/2,l.color)}let t=l.p.l(j).u(y);T(a,C.x+t.x,C.y+t.y,l.size*y/2,l.color)}a.fillStyle="#666";S(a,-1e3+q/2,0,1e3-q/2-.5,1e3);S(a,1e3+q/2,0,1e3-q/2-.5,1e3);S(a,0,-1e3+q/2,1e3,1e3-q/2-.5);S(a,0,1e3+q/2,1e3,1e3-q/2-.5);ut(a,q/2,q/2,q/2+.5,q/2+.5);let w=7*y;let d=.06*G;let m=U(Q/P,0,1);a.fillStyle="#1d1c";a.beginPath();a.rect(C.x-w/2,d,w*m,d);a.fill();a.fillStyle="#444c";a.beginPath();a.rect(C.x+w/2-w*(1-m),d,w*(1-m),d);a.fill();a.fillStyle="#FFF";a.font=.05*G+"px Arial";a.textAlign="center";a.textBaseline="middle";a.fillText(""+N,C.x,.094*G);function v(t){a.fillStyle="rgba(0,0,0,"+t+")";a.beginPath();a.rect(0,0,L,D);a.fill()}function b(t,e,l){a.fillStyle="rgba(255,255,255,"+l+")";a.font=.1*G+"px Arial";a.textAlign="center";a.textBaseline="middle";a.fillText(t,C.x+e,C.y)}function p(t,e){a.fillStyle="rgba(255,255,255,"+e+")";a.font=.1*G+"px Arial";a.textAlign="center";a.textBaseline="middle";a.fillText("Level "+N,C.x+t,C.y)}function g(t,e=false){J+=t;if(J>1){J=0;K=e?0:K+1;return true}return false}if(K===0){if(Q>=P){I=false;J=0;K=1}if(F[0].v>0){J=0;K=100}}if(K===1){g(o*2);v(J)}if(K===2){g(o*2);v(1);p(0,J)}if(K===3){if(g(o*2)){N++;Y()}v(1);p(-J*100,1-J)}if(K===4){g(o*2);v(1);p((1-J)*100,J)}if(K===5){g(o*2);v(1);p(0,1-J)}if(K===6){if(g(o*2,true)){I=true}else{v(1-J)}}if(K===100){g(o*2)}if(K===101){if(g(o*2))I=false;v(J)}if(K===102){if(g(o*2))Y();v(1);b("Game Over",0,J)}if(K===103){g(o*2);v(1);b("Game Over",-J*100,1-J)}if(K===104){g(o*2);v(1);b("Level "+N,(1-J)*100,J)}if(K===105){g(o*2);v(1);b("Level "+N,0,1-J)}if(K===106){if(g(o*2,true))I=true;else v(1-J)}}function it(t){return t.x<z||t.x>=B||t.y<E||t.y>=H}function n(t){return Math.random()*t-t*.5}function rt(l){for(let t=0;t<l.body.length;++t){let e=l.body[t];for(let t=0;t<10;++t)i(e.x+n(.5),e.y+n(.5),l.color)}for(let t=0;t<10;++t)i(l.p.x+n(.5),l.p.y+n(.5),l.color);l.body=[];l.j=[];l.C=0;l.v=1}function ut(t,e,l,n,f){t.strokeStyle="#ff6666";t.lineWidth=.2*y;t.strokeRect(C.x+(e-j.x-n)*y,C.y+(l-j.y-f)*y,n*y*2,f*y*2)}function S(t,e,l,n,f){t.fillRect(C.x+(e-j.x-n)*y,C.y+(l-j.y-f)*y,n*y*2,f*y*2)}function e(t){A=new x(t.clientX*2,t.clientY*2)}k.addEventListener("touchstart",function(t){e(t.touches[0])},false);k.addEventListener("touchmove",function(t){e(t.touches[0])},false);k.addEventListener("touchend",function(t){e(t.touches[0])},false);k.addEventListener("mousemove",function(t){e(t)},false);function h(t,e,l,n,f){t.beginPath();t.arc(e,l,n,0,2*Math.PI,false);t.lineWidth=n*.2;t.fillStyle=f;t.stroke();t.fill()}function T(t,e,l,n,f){t.beginPath();t.arc(e,l,n,0,2*Math.PI,false);t.fillStyle=f;t.fill()}function U(t,e,l){return Math.max(e,Math.min(t,l))}function a(){let t=Math.random()*Math.PI*2;return new x(Math.cos(t),Math.sin(t))}function c(){let t=200;while(true){let e=Math.floor(Math.random()*q);let l=Math.floor(Math.random()*q);if(e<z||e>B||l<E||l>H||--t<0){let t=u[l*q+e];if(t!=null){V(t);return t}}}}function V(e){if(u[e.hash]===e){u[e.hash]=e.next}else{let t=u[e.hash];while(t.next!==e)t=t.next;t.next=t.next.next;e.next=null}}function W(t){let e=U(Math.floor(t.p.x),0,q-1);let l=U(Math.floor(t.p.y),0,q-1);t.hash=l*q+e;t.next=u[t.hash];u[t.hash]=t}let X=0;let f=0;function i(t,e,l){f=Math.max(f-1,0);let n=f>0?{}:c();n.p=new x(t,e);n.size=Math.random()*.2+.35;n.$=1;n.q=Math.random()*Math.PI*2;n.color=l;n.id=X++;W(n)}let r=[];for(let t=0;t<10;++t)r[t]="hsl("+t*(360/10)+", 100%, 50%)";function M(){return r[Math.floor(Math.random()*r.length)]}function Y(){f=q*q*2;X=0;F=[];u=[];u.length=q*q;let e=Math.floor(Math.random()*r.length);let l=e;function n(){let t=l;l=(l+1)%r.length;if(l===e)l=(l+1)%r.length;return t}for(let t=0;t<u.length;++t)u[t]=null;for(let e=0;e<20;++e){let t={};t.p=o(e);t.dir=a();t.id=e;t.size=1;t.j=[];t.body=[];t.O=0;t.C=0;t.v=0;t.G=Math.random()*.4+1.1;t.color=r[n()];t.F=Math.random()<.5?-1:1;t.D=0;t.L=0;t.A=0;F.push(t)}for(let l=0;l<=q;++l){for(let e=0;e<=q;++e){for(let t=0;t<2;++t)i(l+Math.random()-.5,e+Math.random()-.5,M())}}P=1e3+200*N;Q=0}Y();window.requestAnimationFrame(t);const s={passive:false};document.body.addEventListener("touchcancel",w,s);document.body.addEventListener("touchend",w,s);function w(t){t.preventDefault()}}t();